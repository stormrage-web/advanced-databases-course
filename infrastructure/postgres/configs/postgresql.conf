# ===========================
# ОСНОВНЫЕ НАСТРОЙКИ
# ===========================

# Слушать на всех интерфейсах
listen_addresses = '*'

# Максимум подключений
max_connections = 100

# ===========================
# НАСТРОЙКИ ПАМЯТИ
# ===========================

# Общий буфер (25% RAM, для примера 2GB при 8GB RAM)
shared_buffers = 512MB

# Память на операцию сортировки/JOIN
work_mem = 16MB

# Подсказка оптимизатору о доступной памяти для кэша (50-75% RAM)
effective_cache_size = 2GB

# Память для maintenance операций (VACUUM, CREATE INDEX)
maintenance_work_mem = 256MB

# ===========================
# WAL (ЖУРНАЛ ТРАНЗАКЦИЙ)
# ===========================

# Уровень детализации WAL (для репликации и PITR)
wal_level = replica

# Максимальный размер WAL до checkpoint
max_wal_size = 1GB
min_wal_size = 256MB

# Интервал между checkpoint
checkpoint_timeout = 5min

# Растянуть checkpoint на 90% интервала (для плавной нагрузки)
checkpoint_completion_target = 0.9

# Гарантировать запись WAL на диск перед подтверждением транзакции
synchronous_commit = on

# ===========================
# ЛОГИРОВАНИЕ
# ===========================

# Включить сборщик логов
logging_collector = on

# Формат строки лога
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Логировать запросы медленнее 1 секунды
log_min_duration_statement = 1000

# Логировать контрольные точки
log_checkpoints = on

# Логировать подключения
log_connections = on
log_disconnections = on

# ===========================
# СТАТИСТИКА
# ===========================

# Включить pg_stat_statements (уже загружается через shared_preload_libraries)
# Размер буфера для pg_stat_statements
pg_stat_statements.max = 10000
pg_stat_statements.track = all

# ===========================
# АВТОВАКУУМ
# ===========================

# Включить автовакуум
autovacuum = on

# Параметры автовакуума (можно оставить по умолчанию или настроить)
autovacuum_max_workers = 3
autovacuum_naptime = 1min

# ===========================
# РАЗНОЕ
# ===========================

# Часовой пояс (укажите свой)
timezone = 'Europe/Moscow'

# Локаль
lc_messages = 'en_US.UTF-8'
lc_monetary = 'en_US.UTF-8'
lc_numeric = 'en_US.UTF-8'
lc_time = 'en_US.UTF-8'
